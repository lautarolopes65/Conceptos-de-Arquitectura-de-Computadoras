EOI EQU 20H 
IMR EQU 21H
INT0 EQU 24H
PIO EQU 30H
N_F10 EQU 10
HANDSHAKE EQU 40H
ORG 40
IP_F10 DW RUT_F10

ORG 1000H
MSJ DB "INGRESE UN NUMERO DEL 1 AL 9:"
FIN DB ?
DIG DB ?

ORG 3500H
LEER_DIGITO:
  MOV BX,OFFSET MSJ
  MOV AL,OFFSET FIN-OFFSET MSJ
  INT 7
volver:
  MOV BX,OFFSET DIG
  INT 6
  CMP DIG,30H
  JS volver
  CMP DIG,39H
  JNS volver
RET

DESCENDER:
  MOV BX,SP
  ADD BX,2
  MOV AH,[BX]
busy:
  IN AL,HANDSHAKE+1
  AND AL,01H
  JNZ busy
  MOV AL,AH
  OUT HANDSHAKE,AL
  DEC AH
  CMP AH,30H-1
  JNZ busy
RET
ORG 3000H
RUT_F10:
  MOV AX,0
  MOV AL,DIG
  PUSH AX
  CALL DESCENDER
  POP AX
  MOV DL,1
  MOV AL,EOI
  OUT EOI,AL
IRET
ORG 2000H 
  CLI
  MOV AL,0FEH
  OUT IMR,AL
  MOV AL,N_F10
  OUT INT0,AL
  STI
;configuro HANDSHAKE en modo consulta de estado
  IN AL,HANDSHAKE+1
  AND AL,01111111b 
  OUT HANDSHAKE+1,AL
  
  CALL LEER_DIGITO
  MOV DL,0
LOOP: CMP DL,0
  JZ LOOP
 INT 0
END